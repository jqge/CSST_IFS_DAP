CSST-IFS-DAP算法文档
======================

CSST-IFS的1级数据类型包括RSS和CUBE。每个星系的IFS光谱数据保存为一个fits文件，可通过文件名或文件索引号获取。
结合IFS不同巡天的数据使用习惯，IFS的二级数据文件将基于CUBE光谱数据做分析。
CSST-IFS的二级数据处理流程的软件管线称为DAP，DAP处理流程的主要功能包为星系光谱的相关科学参数提取。与之相应，DAP生成的 二级数据fits文件定义为MAP，以和一级数据的CUBE做区分。MAP命名的fits文件作为DAP的最终入库数据产品。

CUBE光谱预处理模块
"""""""""""""""""""""
IFS 数据分析软件从L1-CUBE数据中读取光谱的波长，流量，流量误差，mask值等。
对每条光谱进行银河系消光改正后，按照科学需求决定是否需要空间像素合并提高光谱信噪比，以进行后续的科学参数提取。

输入
~~~~~~~~~~~~~~~~
L1-CUBE光谱立方数据（CSST_IFS_CUBE_{OBJ_id}\ *{VER_cube}*\ {LIN/LOG}_{STM_cube}.fits）

输出
~~~~~~~~~~~~~~~~
L2-precube (光谱分析临时文件)

空间二维map存储模块
"""""""""""""""""""""
存储空间像素的二维map信息，包含R.A.、Dec.、mask_EM、mask_ST（标记个空间像素的是否存在有效发射线/吸收线观测）、
BinID_EM、及BinID_ST（空间像素的二维光谱合并信息）等。

输入
~~~~~~~~~~~~~~~~
L2-precube (光谱分析临时文件)

输出
~~~~~~~~~~~~~~~~
空间像素相关的二维map。

星系运动学参数提取模块
"""""""""""""""""""""
进行星系光谱中的恒星连续谱的拟合，具体使用pPXF拟合软件及E-MILES星族模版库进行恒星连续谱和气体发射线成分的解析。
对于氢的巴尔默线宽度大于500km/s的宽线成分，将采用curvefit进行多成份拟合解析。

输入
~~~~~~~~~~~~~~~~
L2-precube (光谱分析临时文件)

输出
~~~~~~~~~~~~~~~~
1. 光谱文件：每条光谱进行恒星和气体辐射成分的分解，得到L2-precube-star和L2-precube-gas两种光谱, 即恒星连续谱和气体发射线谱。
2. 二维MAP数据：星系运动学参数，包含Ha等巴尔莫线和禁线两套独立的气体运动学参数，及恒星的运动学参数（速度和速度弥散度）等。

发射线流量测量模块
"""""""""""""""""""""
通过lmfit软件拟合得到发射线的流量，结合恒星连续谱得到每条强发射线的等值宽度。

输入
~~~~~~~~~~~~~~~~
L2-precube-star和L2-precube-gas光谱数据

输出
~~~~~~~~~~~~~~~~
气体各发射线的流量和等值宽度二维MAP。

谱指数测量模块
"""""""""""""""""""""
通过lmfit软件拟合得到各吸收线的流量及相关的参数（Lick指数）。

输入
~~~~~~~~~~~~~~~~
L2-precube-star光谱数据

输出
~~~~~~~~~~~~~~~~
各恒星吸收线的流量和Lick指数等的二维MAP。

星族参数拟合模块
"""""""""""""""""""""
进行光谱星族分析，具体使用pPXF拟合软件及E-MILES或基于MaSTAR生成的星族模版库进行包括恒星年龄、金属丰度、消光，质光比等参量的参数提取。

输入
~~~~~~~~~~~~~~~~
L2-precube (光谱分析临时文件)

输出
~~~~~~~~~~~~~~~~
各星族参数的二维MAP。

扣除发射线的光谱CUBE存储模块
"""""""""""""""""""""
将观测光谱进行L2-precube-gas扣除，得到扣除发射线成分后的观测光谱数据。

输入
~~~~~~~~~~~~~~~~
L2-CUBE，L2-precube-star

输出
~~~~~~~~~~~~~~~~
L2-nogas-CUBE

参考文献
----------------------

1. pPXF软件链接：https://www-astro.physics.ox.ac.uk/~cappellari/software/#ppxf
2. lmfit软件链接：https://lmfit.github.io/lmfit-py/

